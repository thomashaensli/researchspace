<ol class="page-breadcrumb">
  <li>
    <mp-link title="Home" url="/">Home</mp-link>
  </li>
  <li>
    <semantic-link title="Documentation" iri='[[resolvePrefix "rsp:Documentation"]]'>Documentation</semantic-link>
  </li>
  <li>
    <semantic-link title="Developer Documentation" iri="http://help.researchspace.org/resource/Start">Developer Documentation</semantic-link>
  </li>

  <li class="active">Open Street Map integration</li>
</ol>

<div class="page">
  <div class='page__body'>
    <h1>Open Street Map integration</h1>
    <p>
      Researchspace allows users to instruct SPARQL queries to call the Open Street Map (OSM) APIs. 
    </p>
    
    <p>
      The integration passes through two phases: first the configuration and then the queyring. The following sections will provide implementation details for each phase.
    </p>

    <h2>1. Configuring the repository</h2>

    <p>
      
      OSM integration requires a custom repository that can be created using the following turtle file.

      The configuration can be also retrieved in the <strong>sample app</strong>. It can be downloaded from <a href="https://github.com/villaitatti/openstreetmap-app">https://github.com/villaitatti/openstreetmap-app</a>.</p>
    

    <mp-code-block mode='text/turtle'>
      <![CDATA[
      @prefix repo: <http://www.openrdf.org/config/repository#> .
      @prefix sr: <http://www.openrdf.org/config/repository/sail#> .
      @prefix sail: <http://www.openrdf.org/config/sail#> .
      @prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
      @prefix ephedra: <http://www.researchspace.org/resource/system/ephedra#> .
      @prefix : <http://www.researchspace.org/resource/system/service/custom#> .

      [] a repo:Repository ;
        repo:repositoryID "openstreetmap" ;
        rdfs:label "A wrapper for the OSM repository" ;
        repo:repositoryImpl [
          repo:repositoryType "openrdf:SailRepository" ;
          sr:sailImpl [
            sail:sailType "researchspace:OpenstreetmapSail" ;
            ephedra:serviceURL "https://nominatim.openstreetmap.org/search" ;
          ] 
        ] .
      ]]>
    </mp-code-block>

    <p>
      It configures a new repository called <code>openstreetmap</code>. It is also explicitly typed as being typed as <code> researchspace:OpenstreetmapSail </code>, which is required to make REST calls.The repository also exposes a <code>serviceURL</code>, which is the OSM REST endpoint.
    </p>

    <h2>2. Query using the service</h2>

    <p><strong>REMEMBER:</strong> the query <strong>MUST</strong> be executed against the repository created in the previous passage, i.e., <code>openstreetmap</code>. Otherwise it will not work.</p>

    <p>
      When the repository is configured and created, any query executed to it will be transformed into a HTTP request.
      
      A query example can be find in the following box or in the sample app <a href="https://github.com/villaitatti/openstreetmap-app">https://github.com/villaitatti/openstreetmap-app</a>.
    </p>

    <mp-code-block mode='SPARQL'>
      <![CDATA[
      SELECT * WHERE {
          ?subject <http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#q> "Venice" .
          ?subject <http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#displayName> ?display_name.
          ?subject <http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#geoText> ?geo_text.
          ?subject <http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#wikidata> ?wikidata
      }
      ]]>
    </mp-code-block>

    <p>
      The federation makes a <code>GET</code> request at the following URL <code>https://nominatim.openstreetmap.org/search?q=PARAMETER&format=json&polygon_text=1&extratags=1</code>
    </p>
    
    <p>
      It accepts the following parameters:
    </p>



<table>
    <tr>
      <td><strong>Type</strong></td>
      <td><strong>IRI</strong></td>
      <td><strong>Description</strong></td>
    </tr>
    <tr>
      <td><strong>Input</strong> (Required)</td>
      <td><code> http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#q </code></td>
      <td>It must contain the string parameter to search. E.g. Venice</td>
    </tr>
    <tr>
      <td><strong>Input</strong> (Optional)</td>
      <td><code> http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#polygon_text </code></td>
      <td>When the parameter is 1, the <code>GET</code> request returns the resulting geometry, otherwise it does not. <br>When not specified in the query, <strong>Default</strong> value is 1
        <br>For more information refer to the <a href="https://nominatim.org/release-docs/develop/api/Search/#output-details">documentation page</a></td>
      
    </tr>
    <tr>
      <td><strong>Input</strong> (Optional)</td>
      <td><code> http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#extratags </code></td>
      <td>
        When the parameter is 1, the <code>GET</code> request returns also other parameters such as the Wikidata ID or Wikipedia page, otherwise it does not. 
        <br>When not specified in the query, <strong>Default</strong> value is 1 
        <br>For more information refer to the <a href="https://nominatim.org/release-docs/develop/api/Search/#output-details">documentation page</a>
      </td>
    </tr>
    <tr>
      <td><strong>Output</strong></td>
      <td><code> http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#displayName </code></td>
      <td>The string describing the requested feature. It cannot be empty.</td>
    </tr>
    <tr>
      <td><strong>Output</strong></td>
      <td><code> http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#geoText </code></td>
      <td>The string in WKT format describing the geografical requested feature. It can be <code>POINT</code> or <code>MULTIPOLYGON</code>. This result is empty if the input parameter <code>polygon_text</code> is 0. </td>
    </tr>
    <tr>
      <td><strong>Output</strong></td>
      <td><code> http://www.researchspace.com/resource/assets/Ontologies/openstreetmap#wikidata </code></td>
      <td>The string describing the Wikidata ID of the requested feature. It can be empty if the input parameter <code>extratags</code> is 0 <strong>or</strong> if the requested feature has no Wikidata ID. </td>
    </tr>
</table>


  </div>
</div>
